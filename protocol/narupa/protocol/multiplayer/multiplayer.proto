// Copyright (c) Intangible Realities Lab, University Of Bristol. All rights reserved.
// Licensed under the GPL. See License.txt in the project root for license information.

syntax = "proto3";
import "google/protobuf/struct.proto";

package narupa.multiplayer;

service Multiplayer {
    // Streams updates of player avatars.
    rpc SubscribePlayerAvatars(SubscribePlayerAvatarsRequest) returns (stream Avatar) {}

    // Streams initial value and then changes of all resources.
    rpc SubscribeAllResourceValues(SubscribeAllResourceValuesRequest) returns (stream ResourceValuesUpdate) {}

    // Create a new player for this multiplayer session.
    rpc CreatePlayer(CreatePlayerRequest) returns (CreatePlayerResponse) {}

    // Call to provide a stream of player avatar updates.
    rpc UpdatePlayerAvatar(stream Avatar) returns (StreamEndedResponse) {}

    // Acquire a lock for a player on a specified resource.
    rpc AcquireResourceLock(AcquireLockRequest) returns (ResourceRequestResponse) {}

    // Release a player's lock on a specified resource.
    rpc ReleaseResourceLock(ReleaseLockRequest) returns (ResourceRequestResponse) {}

    // Set a resource's value.
    rpc SetResourceValue(SetResourceValueRequest) returns (ResourceRequestResponse) {}
}

message StreamEndedResponse {
}

/* Represents an avatar component: e.g. an HMD, controller or glove.*/
message AvatarComponent {
    string name = 1;
    repeated float position = 2;
    repeated float rotation = 3;
}

/* Represents an avatar, a set of components.*/
message Avatar {
    /* Player ID.*/
    string player_id = 1;
    /* List of avatar components.*/
    repeated AvatarComponent component = 2;    
}

message SubscribePlayerAvatarsRequest {
    // Interval between update sends.
    float update_interval = 1;
    // ID of player to ignore (usually either your own ID or none).
    string ignore_player_id = 2;
}

message CreatePlayerRequest {
    // Friendly name for the new player.
    string player_name = 1;
}

message CreatePlayerResponse {
    // The ID assigned to the newly created player.
    string player_id = 1;
}

message AcquireLockRequest {
    // ID of player making request.
    string player_id = 1;
    // Identifier of resource to be locked.
    string resource_id = 2;
}

message ReleaseLockRequest {
    // ID of player making request.
    string player_id = 1;
    // Identifier of resource to be locked.
    string resource_id = 2;
}

message SetResourceValueRequest {
    // ID of player making request
    string player_id = 1;
    // Identifier of resource to be set.
    string resource_id = 2;
    // Value to set the resource to.
    google.protobuf.Value resource_value = 3;
}

message ResourceRequestResponse {
    // Whether the request was successful.
    bool success = 1;
}

message SubscribeAllResourceValuesRequest {
    // Interval between update sends.
    float update_interval = 1;
}

message ResourceValuesUpdate {
    // Map of resource address to updated resource value.
    map<string, google.protobuf.Value> resource_value_changes = 1;
}
